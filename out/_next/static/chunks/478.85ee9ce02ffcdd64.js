(()=>{var e={2818:(e,t,o)=>{"use strict";var n,r;e.exports=(null==(n=o.g.process)?void 0:n.env)&&"object"==typeof(null==(r=o.g.process)?void 0:r.env)?o.g.process:o(7851)},7851:e=>{!function(){var t={229:function(e){var t,o,n,r=e.exports={};function s(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(o){try{return t.call(null,e,0)}catch(o){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var i=[],c=!1,u=-1;function d(){c&&n&&(c=!1,n.length?i=n.concat(i):u=-1,i.length&&p())}function p(){if(!c){var e=l(d);c=!0;for(var t=i.length;t;){for(n=i,i=[];++u<t;)n&&n[u].run();u=-1,t=i.length}n=null,c=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)t[o-1]=arguments[o];i.push(new f(e,t)),1!==i.length||c||l(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=g,r.addListener=g,r.once=g,r.off=g,r.removeListener=g,r.removeAllListeners=g,r.emit=g,r.prependListener=g,r.prependOnceListener=g,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},o={};function n(e){var r=o[e];if(void 0!==r)return r.exports;var s=o[e]={exports:{}},a=!0;try{t[e](s,s.exports,n),a=!1}finally{a&&delete o[e]}return s.exports}n.ab="//";var r=n(229);e.exports=r}()},4801:(e,t,o)=>{"use strict";var n=o(565);async function r(){console.log("Running WebGPU check");try{let e=await navigator.gpu.requestAdapter();if(console.log("Got adapter:",e),!e)throw Error("WebGPU is not supported (no adapter found)")}catch(e){console.error("WebGPU check failed:",e),self.postMessage({status:"error",data:e.toString()})}}console.log("Imported dependencies");class s{static async getInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;console.log("Getting pipeline instance");try{var t,o;return null!==(t=this.tokenizer)&&void 0!==t||(this.tokenizer=await n.v6I.from_pretrained(this.model_id,{progress_callback:e})),console.log("Tokenizer loaded successfully"),null!==(o=this.model)&&void 0!==o||(this.model=await n.W6E.from_pretrained(this.model_id,{dtype:"q4f16",device:"webgpu",progress_callback:e})),console.log("Model loaded successfully"),[this.tokenizer,this.model]}catch(e){throw console.error("Failed to load model:",e),self.postMessage({status:"error",data:"Model loading failed: ".concat(e.message)}),e}}}s.model_id="onnx-community/DeepSeek-R1-Distill-Qwen-1.5B-ONNX";let a=new n.dYU;async function l(e){let t,o;console.log("Starting generation with messages:",e);let[r,l]=await s.getInstance();console.log("Got tokenizer and model instances");let i=r.apply_chat_template(e,{add_generation_prompt:!0,return_dict:!0});console.log("Applied chat template:",i);let[c,u]=r.encode("<think></think>",{add_special_tokens:!1});console.log("Thinking tokens:",c,u);let d="thinking",p=0,f=new n.T1P(r,{skip_prompt:!0,skip_special_tokens:!0,callback_function:e=>{console.log("Output callback:",e),self.postMessage({status:"update",output:e,tps:o,numTokens:p,state:d})},token_callback_function:e=>{console.log("Token callback:",e),null!=t||(t=performance.now()),p++>0&&console.log("Current TPS:",o=p/(performance.now()-t)*1e3),e[0]===u&&(console.log("Switching to answering state"),d="answering")}});console.log("Created streamer"),self.postMessage({status:"start"});let{past_key_values:g,sequences:h}=await l.generate({...i,do_sample:!1,max_new_tokens:2048,streamer:f,stopping_criteria:a,return_dict_in_generate:!0});console.log("Generation complete:",h);let m=r.batch_decode(h,{skip_special_tokens:!0});console.log("Decoded output:",m),self.postMessage({status:"complete",output:m})}function i(e){if(console.log("Progress event:",e),e.total){if(0===e.loaded)console.log("Starting file load:",e.url),self.postMessage({status:"initiate",file:e.url||"model data",progress:0,total:e.total});else if(e.loaded<e.total){let t=Math.round(e.loaded/e.total*100);console.log("Loading progress: ".concat(t,"%")),self.postMessage({status:"progress",file:e.url||"model data",progress:t,total:100})}else console.log("File load complete:",e.url),self.postMessage({status:"done",file:e.url||"model data"})}}async function c(){console.log("Starting model load"),self.postMessage({status:"loading",data:"Loading model..."});try{let[e,t]=await s.getInstance(i);console.log("Model loaded successfully"),self.postMessage({status:"loading",data:"Compiling shaders and warming up model..."});let o=e("a");console.log("Warmup inputs:",o),await t.generate({...o,max_new_tokens:1}),console.log("Warmup complete"),self.postMessage({status:"ready"})}catch(e){console.error("Model load failed:",e),self.postMessage({status:"error",data:"Model load failed: ".concat(e.message)})}}self.addEventListener("message",async e=>{let{type:t,data:o}=e.data;switch(console.log("Received message:",t,o),t){case"check":r();break;case"load":c();break;case"generate":a.reset(),l(o);break;case"interrupt":console.log("Interrupting generation"),a.interrupt();break;case"reset":console.log("Resetting state"),a.reset()}})}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}},a=!0;try{e[n](s,s.exports,o),a=!1}finally{a&&delete t[n]}return s.exports}o.m=e,o.x=()=>{var e=o.O(void 0,[581,714],()=>o(4801));return o.O(e)},(()=>{var e=[];o.O=(t,n,r,s)=>{if(n){s=s||0;for(var a=e.length;a>0&&e[a-1][2]>s;a--)e[a]=e[a-1];e[a]=[n,r,s];return}for(var l=1/0,a=0;a<e.length;a++){for(var[n,r,s]=e[a],i=!0,c=0;c<n.length;c++)(!1&s||l>=s)&&Object.keys(o.O).every(e=>o.O[e](n[c]))?n.splice(c--,1):(i=!1,s<l&&(l=s));if(i){e.splice(a--,1);var u=r();void 0!==u&&(t=u)}}return t}})(),o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce((t,n)=>(o.f[n](e,t),t),[])),o.u=e=>"static/chunks/"+(581===e?"a73d44c2":e)+"-"+({581:"31a7c888aaa7e9de",714:"b35729310b675707"})[e]+".js",o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;o.tt=()=>(void 0===e&&(e={createScriptURL:e=>e},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(e=trustedTypes.createPolicy("nextjs#bundler",e))),e)})(),o.tu=e=>o.tt().createScriptURL(e),o.p="/_next/",(()=>{var e={478:1};o.f.i=(t,n)=>{e[t]||importScripts(o.tu(o.p+o.u(t)))};var t=self.webpackChunk_N_E=self.webpackChunk_N_E||[],n=t.push.bind(t);t.push=t=>{var[r,s,a]=t;for(var l in s)o.o(s,l)&&(o.m[l]=s[l]);for(a&&a(o);r.length;)e[r.pop()]=1;n(t)}})(),(()=>{var e=o.x;o.x=()=>Promise.all([o.e(581),o.e(714)]).then(e)})(),_N_E=o.x()})();